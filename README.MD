## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Spring Boot å’Œ Feign å®¢æˆ·ç«¯çš„é’‰é’‰äº’åŠ¨å¡ç‰‡é›†æˆåº”ç”¨ï¼Œæ—¨åœ¨ç®€åŒ–ä¸é’‰é’‰ API çš„äº¤äº’ï¼Œæä¾›ç¾¤èŠç®¡ç†ã€ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢å’Œå¡ç‰‡æ¶ˆæ¯å‘é€ã€å¡ç‰‡äº’åŠ¨å›è°ƒç­‰åŠŸèƒ½ã€‚é¡¹ç›®é€šè¿‡ Feign å®¢æˆ·ç«¯å°è£…äº†é’‰é’‰ API çš„è°ƒç”¨ï¼Œå¹¶æä¾›äº† RESTful æ¥å£ä¾›å‰ç«¯æˆ–å…¶ä»–æœåŠ¡è°ƒç”¨ã€‚

## åŠŸèƒ½è¯´æ˜

1. **è·å–è®¿é—®ä»¤ç‰Œ**ï¼šé€šè¿‡é’‰é’‰åº”ç”¨çš„ AppKey å’Œ AppSecret è·å–è®¿é—®ä»¤ç‰Œã€‚
2. **ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢**ï¼šæ ¹æ®æ‰‹æœºå·è·å–é’‰é’‰ç”¨æˆ·ä¿¡æ¯ã€‚
3. **ç¾¤èŠç®¡ç†**ï¼š
   - åˆ›å»ºç¾¤èŠ
   - è·å–ç¾¤èŠä¿¡æ¯
4. **å¡ç‰‡æ¶ˆæ¯å‘é€**ï¼š
   - ç¾¤å‘å¡ç‰‡æ¶ˆæ¯
   - å•å‘å¡ç‰‡æ¶ˆæ¯
5. **å›è°ƒå¤„ç†**ï¼šå¤„ç†é’‰é’‰å›è°ƒè¯·æ±‚ï¼Œæ”¯æŒè‡ªå®šä¹‰å›è°ƒé€»è¾‘ã€‚

## ä½¿ç”¨è¯´æ˜

### 1. ç¯å¢ƒ

- Java JDK 17
- Maven 3.9.2
- Spring Boot 3.4.4

### 2. åˆ›å»ºé’‰é’‰åº”ç”¨

åœ¨é’‰é’‰å¼€æ”¾å¹³å°åˆ›å»ºä¸€ä¸ªä¼ä¸šå†…éƒ¨åº”ç”¨ï¼Œè·å– AppKey å’Œ AppSecretã€‚

### 3. åˆ›å»ºè‡ªå®šä¹‰æœºå™¨äºº

è¿›å…¥åˆšåˆšåˆ›å»ºçš„ä¼ä¸šå†…éƒ¨åº”ç”¨ï¼Œåˆ›å»ºè‡ªå®šä¹‰æœºå™¨äººï¼Œè·å–RobotCodeã€‚

### 4. åˆ›å»ºå¡ç‰‡æ¨¡æ¿

åœ¨é’‰é’‰å¼€å‘è€…åå°è¿›å…¥å¡ç‰‡å¹³å°ï¼Œæ–°å»ºæ¨¡æ¿é¡µé¢å¹¶å‘å¸ƒã€‚

### 5. å¼€é€šæ‰€éœ€æƒé™

åœ¨é’‰é’‰å¼€å‘è€…åå°ä¸ºåº”ç”¨å¼€é€šä»¥ä¸‹æƒé™ï¼š
- **é»˜è®¤æƒé™**
- **æ ¹æ®æ‰‹æœºå·è·å–æˆå‘˜åŸºæœ¬ä¿¡æ¯**ï¼šç”¨äºæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚
- **é’‰é’‰ç¾¤åŸºç¡€ä¿¡æ¯ç®¡ç†**ï¼šç”¨äºåˆ›å»ºå’Œç®¡ç†ç¾¤èŠã€‚
- **é’‰é’‰ç¾¤åŸºç¡€ä¿¡æ¯è¯»**ï¼šç”¨äºè·å–ç¾¤èŠä¿¡æ¯ã€‚
- **äº’åŠ¨å¡ç‰‡å®ä¾‹å†™æƒé™**ï¼šç”¨äºå‘é€å¡ç‰‡æ¶ˆæ¯ã€‚


### 6. é…ç½®é’‰é’‰åº”ç”¨ä¿¡æ¯

åœ¨ `application.properties` æ–‡ä»¶ä¸­é…ç½®é’‰é’‰åº”ç”¨çš„ç›¸å…³ä¿¡æ¯ï¼š

```properties
# é’‰é’‰åº”ç”¨é…ç½®
dingtalk.appKey=your_app_key
dingtalk.appSecret=your_app_secret
dingtalk.cardTemplateId=your_card_template_id
dingtalk.robotCode=your_robot_code
dingtalk.callbackType=STREAM
```


## ä½¿ç”¨æ–¹æ³•

### 1. è·å–è®¿é—®ä»¤ç‰Œ

```http
GET /api/dingtalk/access-token
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "errcode": 0,
    "access_token": "your_access_token",
    "errmsg": "ok",
    "expires_in": 7200
  },
  "timestamp": 1696812345678
}
```

### 2. æ ¹æ®æ‰‹æœºå·è·å–ç”¨æˆ·ä¿¡æ¯

```http
GET /api/dingtalk/user?accessToken={accessToken}&mobile={mobile}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "userid": "user_id"
  },
  "timestamp": 1696812345678
}
```

### 3. åˆ›å»ºç¾¤èŠ

```http
POST /api/dingtalk/chat-group?accessToken={accessToken}
Content-Type: application/json

{
  "name": "ç¾¤åç§°",
  "owner": "ç¾¤ä¸»ç”¨æˆ·ID",
  "useridlist": ["æˆå‘˜ç”¨æˆ·ID1", "æˆå‘˜ç”¨æˆ·ID2"],
  "showHistoryType": 1,
  "searchable": 1,
  "validationType": 0,
  "mentionAllAuthority": 0,
  "managementType": 0,
  "chatBannedType": 0
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "errcode": 0,
    "errmsg": "ok",
    "chatid": "chat_id",
    "openConversationId": "open_conversation_id",
    "conversationTag": 0
  },
  "timestamp": 1696812345678
}
```

### 4. è·å–ç¾¤èŠä¿¡æ¯

```http
GET /api/dingtalk/chat-group/{chatId}?accessToken={accessToken}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "owner": "ç¾¤ä¸»ç”¨æˆ·ID",
    "showHistoryType": 1,
    "chatid": "chat_id",
    "validationType": 0,
    "useridlist": ["æˆå‘˜ç”¨æˆ·ID1", "æˆå‘˜ç”¨æˆ·ID2"],
    "icon": "ç¾¤å¤´åƒURL",
    "openConversationId": "open_conversation_id",
    "searchable": 1,
    "chatBannedType": 0,
    "managementType": 0,
    "mentionAllAuthority": 0,
    "conversationTag": 0,
    "name": "ç¾¤åç§°",
    "status": 0
  },
  "timestamp": 1696812345678
}
```

### 5. å‘é€ç¾¤èŠå¡ç‰‡

```http
POST /api/dingtalk/group-card?accessToken={accessToken}&openConversationId={openConversationId}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "deliverResults": [
      {
        "spaceId": "space_id",
        "spaceType": "space_type",
        "success": true,
        "carrierId": "carrier_id"
      }
    ],
    "outTrackId": "out_track_id"
  },
  "timestamp": 1696812345678
}
```

### 6. å‘é€ç§èŠå¡ç‰‡

```http
POST /api/dingtalk/private-card?accessToken={accessToken}&userid={userid}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "msg": "ok",
  "data": {
    "deliverResults": [
      {
        "spaceId": "space_id",
        "spaceType": "space_type",
        "success": true,
        "carrierId": "carrier_id"
      }
    ],
    "outTrackId": "out_track_id"
  },
  "timestamp": 1696812345678
}
```
### 6. å¡ç‰‡äº’åŠ¨å›è°ƒ
**å¡ç‰‡æŒ‰é’®å›è°ƒä½¿ç”¨STREAMæ¨¡å¼ï¼Œç›‘å¬å’Œå¤„ç†å¡ç‰‡äº’åŠ¨æŒ‰é’®ç‚¹å‡»çŠ¶æ€ï¼Œå¯ä¿®æ”¹DefaultCallbackHandleræˆ–ç»§æ‰¿CustomCallbackHandlerè‡ªå®šä¹‰å¤„ç†**
### 7. è¯´æ˜
**å…¶ä½™æ›´å¤šç»†èŠ‚å¯å‚è€ƒé’‰é’‰å®˜æ–¹æ–‡æ¡£**

## é¡¹ç›®ç»“æ„

```
src
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ java
â”‚   â”‚   â””â”€â”€ com.dingtalk
â”‚   â”‚       â”œâ”€â”€ DingTalkApplication.java //é¡¹ç›®çš„ä¸»ç±»ï¼Œç”¨äºå¯åŠ¨ Spring Boot åº”ç”¨
â”‚   â”‚       â”œâ”€â”€ config
â”‚   â”‚       â”‚   â””â”€â”€ DingTalkConfig.java //é…ç½®é’‰é’‰é•¿è¿æ¥å®¢æˆ·ç«¯
â”‚   â”‚       â”œâ”€â”€ controller
â”‚   â”‚       â”‚   â””â”€â”€ DingTalkController.java //æä¾› RESTful API æ¥å£ï¼Œä¾›æµ‹è¯•è°ƒç”¨
â”‚   â”‚       â”œâ”€â”€ feign  //å°è£…é’‰é’‰ API çš„ Feign å®¢æˆ·ç«¯
â”‚   â”‚       â”‚   â”œâ”€â”€ DingTalkClient.java
â”‚   â”‚       â”‚   â””â”€â”€ InitCardInstanceClient.java
â”‚   â”‚       â”œâ”€â”€ handler //å®šä¹‰å›è°ƒå¤„ç†å™¨æ¥å£ï¼Œç”¨äºå¤„ç†é’‰é’‰çš„å›è°ƒè¯·æ±‚
â”‚   â”‚       â”‚   â”œâ”€â”€ CustomCallbackHandler.java
â”‚   â”‚       â”‚   â””â”€â”€ DefaultCallbackHandler.java
â”‚   â”‚       â”œâ”€â”€ listener //é’‰é’‰å›è°ƒç›‘å¬å™¨ï¼Œç”¨äºå¤„ç†é•¿è¿æ¥çš„å›è°ƒè¯·æ±‚
â”‚   â”‚       â”‚   â””â”€â”€ DingTalkCallbackListener.java
â”‚   â”‚       â”œâ”€â”€ model
â”‚   â”‚       â”‚   â”œâ”€â”€ request //å®šä¹‰è¯·æ±‚å¯¹è±¡
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ DingTalkCreateChatRequest.java
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ initcard
â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ BaseDingTalkInitCardRequest.java
â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ GroupCardInitRequest.java
â”‚   â”‚       â”‚   â”‚       â””â”€â”€ PrivateCardInitRequest.java
â”‚   â”‚       â”‚   â””â”€â”€ response //å®šä¹‰å“åº”å¯¹è±¡
â”‚   â”‚       â”‚       â”œâ”€â”€ AccessTokenResponse.java
â”‚   â”‚       â”‚       â”œâ”€â”€ CardCallbackResponse.java
â”‚   â”‚       â”‚       â”œâ”€â”€ CardInstanceResponse.java
â”‚   â”‚       â”‚       â”œâ”€â”€ DingTalkCreateChatResponse.java
â”‚   â”‚       â”‚       â”œâ”€â”€ DingTalkGetChatResponse.java
â”‚   â”‚       â”‚       â””â”€â”€ DingTalkUserResponse.java
â”‚   â”‚       â”œâ”€â”€ response //å®šä¹‰ç»Ÿä¸€çš„å“åº”ç»“æœå¯¹è±¡
â”‚   â”‚       â”‚   â”œâ”€â”€ resenum
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ReturnCode.java
â”‚   â”‚       â”‚   â””â”€â”€ resobj 
â”‚   â”‚       â”‚       â””â”€â”€ ResponseResult.java
â”‚   â”‚       â””â”€â”€ service //å®šä¹‰é’‰é’‰æœåŠ¡çš„æ¥å£ï¼Œå£°æ˜ä¸šåŠ¡æ–¹æ³•
â”‚   â”‚           â”œâ”€â”€ DingTalkService.java
â”‚   â”‚           â””â”€â”€ impl
â”‚   â”‚               â””â”€â”€ DingTalkServiceImpl.java
â”‚   â””â”€â”€ resources //é…ç½®æ–‡ä»¶
â”‚       â”œâ”€â”€ application.properties
â”‚       â””â”€â”€ static //æµ‹è¯•htmlé¡µé¢
â”‚           â””â”€â”€index.html
â””â”€â”€ test
    â””â”€â”€ java
        â””â”€â”€ com.dingtalk
            â””â”€â”€ DingTalkApplicationTests.java
```

## ä¾èµ–é¡¹

é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹ä¾èµ–é¡¹ï¼š
- Spring Boot Starter Web
- Spring Cloud OpenFeign
- Jackson Databind
- DingTalk Stream
- Lombok
- log4j
## ğŸŒ ç½‘é¡µæµ‹è¯•å·¥å…·
  é¡¹ç›®æä¾›å¼€ç®±å³ç”¨çš„å¯è§†åŒ–æµ‹è¯•ç•Œé¢ï¼Œæ”¯æŒæ ¸å¿ƒæ¥å£çš„äº¤äº’å¼è°ƒè¯•ï¼Œä½äºsrc/main/resources/static/index.html